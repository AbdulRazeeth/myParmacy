'use strict'
const racks=[
    //Racks-1 container
    [
        //Shelf-1 Container
        [
            {
                medicineName:'med001',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:2,
            },
            {
                medicineName:'med002',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:4,
            },
            {
                medicineName:'med003',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:3,
            },
        ],
        //shelf-2 container
        [
            {
                medicineName:'med004',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:1,
            },
            {
                medicineName:'med005',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:5,
            },
            {
                medicineName:'med006',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:4,
            },
        ],
        //shelf-3 container
        [
            {
                medicineName:'med007',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:6,
            },
            {
                medicineName:'med008',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:7,
            },
            {
                medicineName:'med009',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:9,
            },
        ]
    ],
    //rack-2 container
    [
        //Shelf-1 Container
        [
            {
                medicineName:'med010',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:1,
            },
            {
                medicineName:'med011',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:2,
            },
            {
                medicineName:'med012',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:4,
            },
        ],
        //shelf-2 container
        [
            {
                medicineName:'med013',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:9,
            },
            {
                medicineName:'med014',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:2,
            },
            {
                medicineName:'med015',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:1,
            },
        ],
        //shelf-3 container
        [
            {
                medicineName:'med016',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:6,
            },
            {
                medicineName:'med017',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:7,
            },
            {
                medicineName:'med018',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:12,
            },
        ]
    ],
    //rack-3 container
    [
        //Shelf-1 Container
        [
            {
                medicineName:'med019',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:1,
            },
            {
                medicineName:'med020',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:2,
            },
            {
                medicineName:'med021',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:3,
            },
        ],
        //shelf-2 container
        [
            {
                medicineName:'med022',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:1,
            },
            {
                medicineName:'med023',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:8,
            },
            {
                medicineName:'med024',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:13,
            },
        ],
        //shelf-3 container
        [
            {
                medicineName:'med025',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:2,
            },
            {
                medicineName:'med026',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:9,
            },
            {
                medicineName:'med027',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:7,
            },
        ]
    ],
    //rack-4 container
    [
        //Shelf-1 Container
        [
            {
                medicineName:'med028',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:6,
            },
            {
                medicineName:'med029',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:5,
            },
            {
                medicineName:'med030',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:4,
            },
        ],
        //shelf-2 container
        [
            {
                medicineName:'med031',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:3,
            },
            {
                medicineName:'med032',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:2,
            },
            {
                medicineName:'med033',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:1,
            },
        ],
        //shelf-3 container
        [
            {
                medicineName:'med034',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:10,
            },
            {
                medicineName:'med035',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:11,
            },
            {
                medicineName:'med036',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:7,
            },
        ]
    ],
    //rack-5 container
    [
        //Shelf-1 Container
        [
            {
                medicineName:'med037',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:9,
            },
            {
                medicineName:'med038',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:3,
            },
            {
                medicineName:'med039',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:14,
            },
        ],
        //shelf-2 container
        [
            {
                medicineName:'med040',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:12,
            },
            {
                medicineName:'med041',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:11,
            },
            {
                medicineName:'med042',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:12,
            },
        ],
        //shelf-3 container
        [
            {
                medicineName:'med043',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:16,
            },
            {
                medicineName:'med044',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:8,
            },
            {
                medicineName:'med045',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:3,
            },
        ]
    ],
    //rack-6 container
    [
        //Shelf-1 Container
        [
            {
                medicineName:'med046',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:1,
            },
            {
                medicineName:'med047',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:2,
            },
            {
                medicineName:'med048',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:10,
            },
        ],
        //shelf-2 container
        [
            {
                medicineName:'med049',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:4,
            },
            {
                medicineName:'med050',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:5,
            },
            {
                medicineName:'med051',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:3,
            },
        ],
        //shelf-3 container
        [
            {
                medicineName:'med052',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:4,
            },
            {
                medicineName:'med053',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:8,
            },
            {
                medicineName:'med054',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:6,
            },
        ]
    ],
    //rack-7 container
    [
        //Shelf-1 Container
        [
            {
                medicineName:'med055',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:5,
            },
            {
                medicineName:'med056',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:8,
            },
            {
                medicineName:'med057',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:3,
            },
        ],
        //shelf-2 container
        [
            {
                medicineName:'med058',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:2,
            },
            {
                medicineName:'med059',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:16,
            },
            {
                medicineName:'med060',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:5,
            },
        ],
        //shelf-3 container
        [
            {
                medicineName:'med061',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:3,
            },
            {
                medicineName:'med062',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:1,
            },
            {
                medicineName:'med063',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:3,
            },
        ]
    ],
    //rack-8 container
    [
        //Shelf-1 Container
        [
            {
                medicineName:'med064',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:10,
            },
            {
                medicineName:'med065',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:16,
            },
            {
                medicineName:'med066',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:13,
            },
        ],
        //shelf-2 container
        [
            {
                medicineName:'med067',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:5,
            },
            {
                medicineName:'med068',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:9,
            },
            {
                medicineName:'med069',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:8,
            },
        ],
        //shelf-3 container
        [
            {
                medicineName:'med070',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:3,
            },
            {
                medicineName:'med071',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:2,
            },
            {
                medicineName:'med072',
                totalCapacity:100,
                currentQuantity:100,
                pricePerUnit:12,
            },
        ]
    ],
]
let activeRack
let totalPrice
let availability
let totalPriceUpdate = document.getElementById('price')
let showBiller = document.getElementById('billing-menu')
let medicineName =  document.getElementById('med-name')
let totalCapacity = document.getElementById('total-cap')
let availableQuantity = document.getElementById('avai-quan')
let pricePerUnit = document.getElementById('price-unit')
let numberOfQuantity
let result
let way = document.getElementById('pathWay')
let selectedRack
let selectedShelf
let selectedContainer
let searchValue
let viewSelector = document.querySelector('#content')
let toHighLight
let activeShelf
let activeContainer
let dynamic
let medListArr =[]
let showRack = 0
let cssVariableSelector = document.querySelector(':root')
let tableDetail
let takeInput
function search(value){
    searchValue = document.getElementById('input-value').value.toLowerCase() || clickValue || containerClick
    takeInput = document.getElementById('input-value').value.toLowerCase()
    for(let i=0; i<value.length; i++){
        for(let j=0; j<value[i].length; j++){
            for(let k=0; k<value[i][j].length;k++){
                if(searchValue === value[i][j][k].medicineName){
                     result = `The medicine is in Rack-${i+1} of shelf-${j+1} of container-${k+1}`
                    selectedRack = value[i]
                    showRack = i
                    selectedShelf = value[i][j]
                    selectedContainer = value[i][j][k]
                    activeRack = viewSelector.children[i]
                    console.log(activeRack)
                    if(dynamic){
                        document.getElementById(dynamic).classList.remove('high-light-color')
                    }
                    cssVariableSelector.style.setProperty('--selectedRack',`${i}`)      
                    activeContainer =`${i}${j}container${k+1}`
                    document.getElementById(activeContainer).classList.add('high-light-color')
                    dynamic = activeContainer
                    clear()
                    pathWay(result)
                    medicineDetail(selectedContainer)
                    medicineHighlight(medListArr)
                }
            }
        }
    }
}
let dynamicValue
function medicineHighlight(value){
    if(dynamicValue){
        document.getElementById(dynamicValue).classList.remove('yellow')
    }
    for(let m=0; m<value.length; m++){
        let compare = document.getElementById(`table-detail${m+1}`)
        if(compare.children[0].innerHTML === searchValue){
            compare.classList.add('yellow')
            quantityChange= compare.children[1]
            dynamicValue = `table-detail${m+1}`
        }
    }
}
function clear(){
    document.getElementById('input-value').value = '';
    document.getElementById('quantity').value = '';
    document.getElementById('price').innerHTML = '';
    // document.getElementById(dynamicTable).classList.remove('yellow')
}
function next(value){
    showRack = value+1
    cssVariableSelector.style.setProperty('--selectedRack',`${value+1}`)
}
function previous(value){
    showRack = value-1
    cssVariableSelector.style.setProperty('--selectedRack',`${value-1}`)
}
function pathWay(value){
    way.innerHTML = value
}
function medicineDetail(value){
    console.log(value)
    medicineName.innerHTML = value.medicineName;
    totalCapacity.innerHTML = value.totalCapacity;
    availableQuantity.innerHTML = value.currentQuantity;
    pricePerUnit.innerHTML = value.pricePerUnit;
}
function showBillingMenu(){
    showBiller.classList.remove('hide')
}
function notification(value){
    if(value<30){
        // document.getElementById(activeContainer).classList.remove('high-light-Color')
        document.getElementById(activeContainer).classList.add('blink')
    }
}
function billing(selectedContainer){
    numberOfQuantity =document.getElementById('quantity').value;
    quantityHolder.push(Number(numberOfQuantity))
    console.log(quantityHolder)
    if(numberOfQuantity > 100 || numberOfQuantity <= 0){
        alert('Enter the valid Quantity(1-100) to bill')
        return
    }
    availability = selectedContainer.currentQuantity - numberOfQuantity;
    if(availability<=0){
        alert('The required quantity is not available')
        return
    }
    quantityChange.innerHTML = availability
    selectedContainer.currentQuantity = availability;
    medicineDetail(selectedContainer)
    totalPrice = numberOfQuantity*selectedContainer.pricePerUnit
    totalPriceHolder.push(totalPrice)
    masterBilling(iteration)
    dateTime()
    totalPriceUpdate.innerHTML = totalPrice
    notification(availability)
}
function rackGenerator(value){
    for (let i=0; i<value.length; i++){
        let rack =document.createElement('div')
        rack.id = 'rack'+(i+1)
        rack.className ='scene layer-'+(i+1);
        let cuboid = document.createElement('div')
        cuboid.className = 'cuboid rack-'+(i+1)
        let front = document.createElement('div')
        front.className = 'front cuboid-common-face'
        cuboid.appendChild(front)
        let shelfLength = value[i]
        for(let j=0; j<shelfLength.length; j++){
            let shelf =document.createElement('div')
            shelf.className = 'shelf'
            shelf.id = i+'shelf-'+(j+1)
            let container = shelfLength[j]
            for(let k=0; k<container.length; k++){
                let tabletContainer = document.createElement('div')
                tabletContainer.className = 'container'
                tabletContainer.id = `${i}${j}container${k+1}`
                tabletContainer.setAttribute('onClick','containerBackground(this.id)')
                tabletContainer.innerHTML = value[i][j][k].medicineName
                shelf.appendChild(tabletContainer)
            }
            front.appendChild(shelf)
    }
    cuboid.appendChild(front)
    let back = document.createElement('div')
    back.className ='back cuboid-common-face rack-background'
    cuboid.appendChild(back)
    let right = document.createElement('div')
    right.className ='right cuboid-common-face rack-background'
    cuboid.appendChild(right)
    let left = document.createElement('div')
    left.className ='left cuboid-common-face rack-background pharmacy-flex pharmacy-center pharmacy-justify-center'
    let rackName = document.createElement('span')
    rackName.className = 'rack-name-style'
    rackName.innerHTML =`Rack ${i+1}`
    left.appendChild(rackName)
    cuboid.appendChild(left)
    let top = document.createElement('div')
    top.className ='top cuboid-common-face rack-background'
    cuboid.appendChild(top)
    let bottom = document.createElement('div')
    bottom.className ='bottom cuboid-common-face rack-background'
    cuboid.appendChild(bottom)
    rack.appendChild(cuboid)
    document.getElementById('content').appendChild(rack)
}
}
rackGenerator(racks)
function takeMedicine(value){
    for(let a=0; a<value.length; a++){
        for(let b=0; b<value[a].length; b++){
            for(let c=0; c<value[a][b].length; c++){
                medListArr.push(value[a][b][c])
            }
        }
    }
    tableGenerator(medListArr)
}
let iteration = 0
let billMedicineName
let billQuantity
let medicineRate
let billTotalAmount
let quantityHolder=[]
let totalPriceHolder = []
function masterBilling(value){
    iteration = value+1
    billMedicineName = document.createElement('span')
    billMedicineName.className =`bill-med-name`
    billMedicineName.id = `bill-med-name${value+1}`
    document.getElementById('bill-list').appendChild(billMedicineName)
    billQuantity = document.createElement('span')
    billQuantity.className ='bill-quantity'
    billQuantity.id=`bill-quantity${value+1}`
    document.getElementById('bill-list').appendChild(billQuantity)
    medicineRate = document.createElement('span')
    medicineRate.className = 'bill-med-rate'
    medicineRate.id = `bill-med-rate${value+1}`
    document.getElementById('bill-list').appendChild(medicineRate)
    billTotalAmount = document.createElement('span')
    billTotalAmount.className = 'bill-total-amount'
    billTotalAmount.id =`bill-total-amount${value+1}`
    document.getElementById('bill-list').appendChild(billTotalAmount)
    masterBilligValue()
}
function dateTime(){
    let d =  new Date()
    document.getElementById('date-value').innerHTML = d.toLocaleDateString()
    document.getElementById('time-value').innerHTML =`${d.getHours()}:${d.getMinutes()}`
}
function masterBilligValue(){
    let billMedName = document.getElementById(billMedicineName.id)
    let enteredQuantity = document.getElementById(billQuantity.id)
    let particularPrice = document.getElementById(medicineRate.id)
    let totalIndividualPrice = document.getElementById(billTotalAmount.id)
    billMedName.innerHTML =selectedContainer.medicineName
    enteredQuantity.innerHTML = numberOfQuantity
    particularPrice.innerHTML = selectedContainer.pricePerUnit
    totalIndividualPrice.innerHTML = totalPrice
    let totalItems = document.getElementById('total-items')
    totalItems.innerHTML = iteration
    let totalQuantity =document.getElementById('total-quantity')
    totalQuantity.innerHTML =quantityHolder.reduce(reduceFunction)
    let wholeMedPrice = document.getElementById('total-price')
    wholeMedPrice.innerHTML = totalPriceHolder.reduce(reduceFunction)
}
function reduceFunction(total,num){
    return total + num
}
function tableGenerator(value){
    document.getElementById('table-container').innerHTML =''
    let tableHeader = document.createElement('div')
    tableHeader.className ='detail show-scroll'
    tableHeader.id = 'header'
    let headerOne = document.createElement('div')
    headerOne.id = 'medicine'
    headerOne.className = 'table-header-style'
    tableHeader.appendChild(headerOne)
    let headerTwo = document.createElement('div')
    headerTwo.id = 'med-quantity'
    headerTwo.className ='table-header-style'
    tableHeader.appendChild(headerTwo)
    document.getElementById('table-container').appendChild(tableHeader);
    let sortSection = document.createElement('div')
    sortSection.className = 'sort-style pharmacy-flex pharmacy-justify-spacebetween pharmacy-center'
    let sortTitle = document.createElement('span')
    sortTitle.innerHTML = 'Sort-By'
    sortSection.appendChild(sortTitle)
    let iconSection =document.createElement('div')
    iconSection.className ='pharmacy-flex common-gap'
    let iconAscending = document.createElement('span')
    iconAscending.className ="material-symbols-outlined"
    iconAscending.setAttribute('onClick','sortAscending(medListArr)')
    iconAscending.innerHTML = 'arrow_downward'
    iconSection.appendChild(iconAscending)
    let iconDescending = document.createElement('span')
    iconDescending.className = 'material-symbols-outlined'
    iconDescending.setAttribute('onClick','sortDescending(medListArr)')
    iconDescending.innerHTML = 'arrow_upward'
    iconSection.appendChild(iconDescending)
    sortSection.appendChild(iconSection)
    document.getElementById('table-container').appendChild(sortSection)
    document.getElementById('medicine').innerHTML = 'Medicine Name'
    document.getElementById('med-quantity').innerHTML = 'Available Quantity'
            for(let o=0; o<value.length; o++){
                tableDetail = document.createElement('div')
                tableDetail.className ='detail table-gap'
                tableDetail.id = `table-detail${o+1}`
                tableDetail.setAttribute('onclick','tableBackground(this.id)')
                let medicine = document.createElement('div')
                medicine.id = `medicine${o+1}`
                tableDetail.appendChild(medicine)
                let count =document.createElement('div')
                count.id = `quantity${o+1}`
                tableDetail.appendChild(count)
                document.getElementById('table-container').appendChild(tableDetail)
                document.getElementById(`medicine${o+1}`).innerHTML = value[o].medicineName
                document.getElementById(`quantity${o+1}`).innerHTML = value[o].currentQuantity
            }
}
// tableGenerator(medListArr)
let dynamicContainer
let parentContainerId
let parentTableId
let clickValue
let dynamicTable
let containerClick
let quantityChange
function tableBackground(clicked_id){
    if(dynamicTable){
        document.getElementById(dynamicTable).classList.remove('yellow')
    }
     parentTableId=document.getElementById(clicked_id)
     clickValue = parentTableId.children[0].innerHTML
     quantityChange = parentTableId.children[1]
     document.getElementById(clicked_id).classList.add('yellow')
     dynamicTable = clicked_id
     console.log(searchValue)
     search(racks)
}
function containerBackground(clicked_id){
    if(dynamicContainer){
        document.getElementById(dynamicContainer).classList.remove('high-light-color')
    }
    parentContainerId = document.getElementById(clicked_id)
    containerClick = parentContainerId.innerHTML
    parentContainerId.classList.add('high-light-color')
    dynamicContainer =clicked_id
    search(racks)
}
function sortAscending(){
    medListArr.sort(function(a,b){
        return a.currentQuantity - b.currentQuantity
    })
    console.log(medListArr)
    tableGenerator(medListArr)
}
function sortDescending(){
    medListArr.sort(function(a,b){
        return b.currentQuantity - a.currentQuantity
    })
    console.log(medListArr)
    tableGenerator(medListArr)
}
takeMedicine(racks)



